<?php
require_once __DIR__ . '/../includes/config.php';
$stmt = $pdo->query('SELECT * FROM products ORDER BY created_at DESC');
$products = $stmt->fetchAll(PDO::FETCH_ASSOC);
require_once __DIR__ . '/../includes/header.php';
?>
<section class="product-grid">
  <?php foreach($products as $p): ?>
    <article class="card">
      <img src="<?php echo htmlspecialchars($p['image']); ?>" alt="" style="max-width:100%;height:140px;object-fit:cover">
      <h3><?php echo htmlspecialchars($p['name']); ?></h3>
      <p>₹<?php echo number_format($p['price'],2); ?></p>
      <a href="/product.php?id=<?php echo $p['id']; ?>">View</a>
      <form method="post" action="/add_to_cart.php">
        <input type="hidden" name="product_id" value="<?php echo $p['id']; ?>">
        <button type="submit">Add to cart</button>
      </form>
    </article>
  <?php endforeach; ?>
</section>
</main>
<script src="/assets/js/main.js"></script>
</body>
</html>

<?php
require_once __DIR__ . '/../includes/config.php';
if($_SERVER['REQUEST_METHOD'] !== 'POST') { header('Location: shop.php'); exit; }
$product_id = (int)$_POST['product_id'];
$qty = isset($_POST['quantity']) ? max(1,(int)$_POST['quantity']) : 1;
$cart_id = getCartId($pdo);
$stmt = $pdo->prepare('SELECT id,quantity FROM cart_items WHERE cart_id = ? AND product_id = ? LIMIT 1');
$stmt->execute([$cart_id,$product_id]);
$row = $stmt->fetch(PDO::FETCH_ASSOC);
if($row){
    $newQ = $row['quantity'] + $qty;
    $stmt = $pdo->prepare('UPDATE cart_items SET quantity = ? WHERE id = ?');
    $stmt->execute([$newQ,$row['id']]);
} else {
    $stmt = $pdo->prepare('INSERT INTO cart_items (cart_id,product_id,quantity) VALUES (?,?,?)');
    $stmt->execute([$cart_id,$product_id,$qty]);
}
header('Location: cart.php');
exit;

<?php
require_once __DIR__ . '/../includes/config.php';
// very simple admin: no auth; for demo only
$errors = [];
if($_SERVER['REQUEST_METHOD'] === 'POST'){
    $name = trim($_POST['name']);
    $desc = trim($_POST['description']);
    $price = (float)$_POST['price'];
    $image_path = 'assets/img-placeholder.png';
    if(isset($_FILES['image']) && $_FILES['image']['error'] === UPLOAD_ERR_OK){
        $tmp = $_FILES['image']['tmp_name'];
        $fname = basename($_FILES['image']['name']);
        $dst = __DIR__ . '/assets/uploads/';
        if(!is_dir($dst)) mkdir($dst, 0755, true);
        $target = '/assets/uploads/' . time() . '_' . preg_replace('/[^a-zA-Z0-9_\.\-]/','_', $fname);
        move_uploaded_file($tmp, __DIR__ . $target);
        $image_path = $target;
    }
    if(!$name || !$price) $errors[] = 'Name and price required.';
    if(empty($errors)){
        $stmt = $pdo->prepare('INSERT INTO products (name,description,price,image) VALUES (?,?,?,?)');
        $stmt->execute([$name,$desc,$price,$image_path]);
        header('Location: admin.php');
        exit;
    }
}
require_once __DIR__ . '/../includes/header.php';
?>
<section class="form-wrap">
  <h2>Admin - Add Product</h2>
  <?php if($errors): ?><div class="errors">
  <?php echo implode('<br>',$errors); ?></div><?php endif; ?>
  <form method="post" enctype="multipart/form-data">
    <label>Product name<input name="name" required></label>
    <label>Description<textarea name="description"></textarea></label>
    <label>Price<input name="price" type="number" step="0.01" required></label>
    <label>Image<input name="image" type="file" accept="image/*"></label>
    <button type="submit">Add Product</button>
  </form>
  <hr>
  <h3>Existing products</h3>
  <ul>
    <?php
    $stmt = $pdo->query('SELECT * FROM products ORDER BY id DESC');
    while($p = $stmt->fetch(PDO::FETCH_ASSOC)){
        echo '<li>' . htmlspecialchars($p['name']) . ' - ₹' . number_format($p['price'],2) . '</li>';
    }
    ?>
  </ul>
</section>
</main>
<script src="/assets/js/main.js""></script>
</body>
</html>

<?php
require_once __DIR__ . '/../includes/config.php';
$cart_id = getCartId($pdo);
$stmt = $pdo->prepare('SELECT ci.id as item_id, p.* , ci.quantity FROM cart_items ci JOIN products p ON p.id = ci.product_id WHERE ci.cart_id = ?');
$stmt->execute([$cart_id]);
$items = $stmt->fetchAll(PDO::FETCH_ASSOC);
require_once __DIR__ . '/../includes/header.php';
?>
<section class="cart">
  <h2>Your Cart</h2>
  <?php if(empty($items)): ?>
    <p>Cart khali hai. <a href="shop.php">Shop now</a></p>
  <?php else: ?>
    <table>
      <thead><tr><th>Product</th><th>Price</th><th>Qty</th><th>Subtotal</th><th></th></tr></thead>
      <tbody>
        <?php $total=0; foreach($items as $it): ?>
          <?php $sub = $it['price'] * $it['quantity']; $total += $sub; ?>
          <tr>
            <td><?php echo htmlspecialchars($it['name']); ?></td>
            <td>₹<?php echo number_format($it['price'],2); ?></td>
            <td><?php echo $it['quantity']; ?></td>
            <td>₹<?php echo number_format($sub,2); ?></td>
            <td>
              <form method="post" action="/remove_from_cart.php">
                <input type="hidden" name="id" value="<?php echo $it['item_id']; ?>">
                <button type="submit">Remove</button>
              </form>
            </td>
          </tr>
        <?php endforeach; ?>
      </tbody>
    </table>
    <p class="total">Total: ₹<?php echo number_format($total,2); ?></p>
    <a class="btn" href="/checkout.php">Proceed to Checkout</a>
  <?php endif; ?>
</section>
</main>
<script src="/assets/js/main.js"></script>
</body>
</html>

<?php
require_once __DIR__ . '/../includes/config.php';
$cart_id = getCartId($pdo);
$stmt = $pdo->prepare('SELECT p.price, ci.quantity FROM cart_items ci JOIN products p ON p.id = ci.product_id WHERE ci.cart_id = ?');
$stmt->execute([$cart_id]);
$items = $stmt->fetchAll(PDO::FETCH_ASSOC);
$total = 0;
foreach($items as $it) $total += $it['price'] * $it['quantity'];
require_once __DIR__ . '/../includes/header.php';
?>
<section class="form-wrap">
  <h2>Checkout</h2>
  <p>Total: ₹<?php echo number_format($total,2); ?></p>
  <p>This is a placeholder checkout. To integrate payments (e.g. Razorpay or Stripe), add server-side order creation and client-side payment JS.</p>
  <p><strong>Razorpay quick hint:</strong> create order on server, then include Razorpay checkout on client and call open() with returned order_id.</p>
  <p>If you want, I can add a working Razorpay example (requires your API keys).</p>
</section>
</main>
<script src="/assets/js/main.js"></script>
</body>
</html>

<?php require_once __DIR__ . '/../includes/header.php'; ?>
<section style="text-align:center;padding:40px;">
  <h1>Welcome to My Shop</h1>
  <p><a class="btn" href="/shop.php">Start shopping</a></p>
</section>
</main>
<script src="/assets/js/main.js"></script>
</body>
</html>

<?php
require_once __DIR__ . '/../includes/config.php';
$errors = [];
if($_SERVER['REQUEST_METHOD'] === 'POST'){
    $email = trim($_POST['email']);
    $password = $_POST['password'];
    if(!$email || !$password) $errors[] = 'Fields required.';
    if(empty($errors)){
        $stmt = $pdo->prepare('SELECT id,name,password FROM users WHERE email = ? LIMIT 1');
        $stmt->execute([$email]);
        $user = $stmt->fetch(PDO::FETCH_ASSOC);
        if($user && password_verify($password, $user['password'])){
            $_SESSION['user_id'] = $user['id'];
            $_SESSION['user_name'] = $user['name'];
            if(isset($_SESSION['cart_id'])){
                $stmt = $pdo->prepare('UPDATE carts SET user_id = ? WHERE id = ?');
                $stmt->execute([$_SESSION['user_id'], $_SESSION['cart_id']]);
            }
            header('Location: shop.php');
            exit;
        } else {
            $errors[] = 'Invalid credentials.';
        }
    }
}
require_once __DIR__ . '/../includes/header.php';
?>
<section class="form-wrap">
  <h2>Login</h2>
  <?php if($errors): ?><div class="errors"><?php echo implode('<br>', $errors); ?></div><?php endif; ?>
  <form method="post">
    <label>Email<input name="email" type="email" required></label>
    <label>Password<input name="password" type="password" required></label>
    <button type="submit">Login</button>
  </form>
</section>
</main>
<script src="/assets/js/main.js"></script>
</body>
</html>

<?php
require_once __DIR__ . '/../includes/config.php';
session_unset();
session_destroy();
header('Location: index.php');
exit;

<?php
require_once __DIR__ . '/../includes/config.php';
$id = (int)($_GET['id'] ?? 0);
$stmt = $pdo->prepare('SELECT * FROM products WHERE id = ? LIMIT 1');
$stmt->execute([$id]);
$p = $stmt->fetch(PDO::FETCH_ASSOC);
if(!$p) { header('Location: shop.php'); exit; }
require_once __DIR__ . '/../includes/header.php';
?>
<section class="product-detail">
  <img src="<?php echo htmlspecialchars($p['image']); ?>" style="max-width:320px">
  <h2><?php echo htmlspecialchars($p['name']); ?></h2>
  <p><?php echo nl2br(htmlspecialchars($p['description'])); ?></p>
  <p>₹<?php echo number_format($p['price'],2); ?></p>
  <form method="post" action="/add_to_cart.php">
    <input type="hidden" name="product_id" value="<?php echo $p['id']; ?>">
    <label>Qty <input type="number" name="quantity" value="1" min="1"></label>
    <button type="submit">Add to cart</button>
  </form>
</section>
</main>
<script src="/assets/js/main.js"></script>
</body>
</html>

<?php
require_once __DIR__ . '/../includes/config.php';
$errors = [];
if($_SERVER['REQUEST_METHOD'] === 'POST'){
    $name = trim($_POST['name']);
    $email = trim($_POST['email']);
    $password = $_POST['password'];
    $password2 = $_POST['password2'];

    if(!$name || !$email || !$password) $errors[] = 'Sab fields bharein.';
    if($password !== $password2) $errors[] = 'Passwords match nahi karte.';

    if(empty($errors)){
        $stmt = $pdo->prepare('SELECT id FROM users WHERE email = ? LIMIT 1');
        $stmt->execute([$email]);
        if($stmt->fetch()){
            $errors[] = 'Email already registered.';
        } else {
            $hash = password_hash($password, PASSWORD_DEFAULT);
            $stmt = $pdo->prepare('INSERT INTO users (name,email,password) VALUES (?,?,?)');
            $stmt->execute([$name,$email,$hash]);
            header('Location: login.php');
            exit;
        }
    }
}
require_once __DIR__ . '/../includes/header.php';
?>
<section class="form-wrap">
  <h2>Register</h2>
  <?php if($errors): ?><div class="errors"><?php echo implode('<br>', $errors); ?></div><?php endif; ?>
  <form method="post">
    <label>Name<input name="name" required></label>
    <label>Email<input name="email" type="email" required></label>
    <label>Password<input name="password" type="password" required></label>
    <label>Confirm Password<input name="password2" type="password" required></label>
    <button type="submit">Register</button>
  </form>
</section>
</main>
<script src="/assets/js/main.js"></script>
</body>
</html>

<?php
require_once __DIR__ . '/../includes/config.php';
if($_SERVER['REQUEST_METHOD'] === 'POST'){
  $id = (int)$_POST['id'];
  $stmt = $pdo->prepare('DELETE FROM cart_items WHERE id = ?');
  $stmt->execute([$id]);
}
header('Location: cart.php');

<?php
// includes/header.php
// Header intended to be included from files inside the 'public/' folder.
// It uses relative paths to reach assets at ../assets.

if (!isset($pdo)) {
    require_once __DIR__ . '/config.php';
}

$cart_count = 0;
if (isset($_SESSION['cart_id'])) {
    try {
        $stmt = $pdo->prepare('SELECT SUM(quantity) AS total FROM cart_items WHERE cart_id = ?');
        $stmt->execute([$_SESSION['cart_id']]);
        $cart_count = (int)($stmt->fetchColumn() ?? 0);
    } catch (Exception $e) {
        $cart_count = 0;
    }
}

$asset_base = '../assets';
?>
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>My Shop</title>
  <link rel="stylesheet" href="<?php echo $asset_base; ?>/css/style.css">
</head>
<body>
<header class="site-header" style="display:flex;justify-content:space-between;align-items:center;padding:16px;background:#fff;">
  <div style="font-weight:700;"><a href="index.php" style="text-decoration:none;color:inherit;">My Shop</a></div>
  <nav>
    <a href="shop.php">Shop</a>
    <a href="cart.php">Cart (<?php echo $cart_count; ?>)</a>
    <?php if(isset($_SESSION['user_id'])): ?>
      <span style="margin-left:8px;">Hi, <?php echo htmlspecialchars($_SESSION['user_name'] ?? ''); ?></span>
      <a href="logout.php" style="margin-left:8px;">Logout</a>
    <?php else: ?>
      <a href="login.php" style="margin-left:8px;">Login</a>
      <a href="register.php" style="margin-left:8px;">Register</a>
    <?php endif; ?>
  </nav>
</header>

<main style="padding:20px;">
<?php
// includes/config.php
session_start();

// Update these with your local DB credentials
$db_host = 'localhost';
$db_name = 'ecommerce';
$db_user = 'root';
$db_pass = '';

try {
    $pdo = new PDO("mysql:host=$db_host;dbname=$db_name;charset=utf8mb4", $db_user, $db_pass);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die('Database connection failed: ' . $e->getMessage());
}

function getCartId($pdo) {
    if(isset($_SESSION['cart_id'])) return $_SESSION['cart_id'];
    $session_id = session_id();
    $user_id = isset($_SESSION['user_id']) ? $_SESSION['user_id'] : null;

    $stmt = $pdo->prepare('SELECT id FROM carts WHERE session_id = ? LIMIT 1');
    $stmt->execute([$session_id]);
    $row = $stmt->fetch(PDO::FETCH_ASSOC);
    if($row) {
        $_SESSION['cart_id'] = $row['id'];
        return $row['id'];
    }
    $stmt = $pdo->prepare('INSERT INTO carts (user_id, session_id) VALUES (?, ?)');
    $stmt->execute([$user_id, $session_id]);
    $id = $pdo->lastInsertId();
    $_SESSION['cart_id'] = $id;
    return $id;
}

body
{
font-family:Arial,
Helvetica,sans-serif;margin:0;padding:0;background:#f6f6f6;color:aqua}
.site-header{display:flex;justify-content:space-between;align-items:center;padding:16px;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,0.06)}
.site-header .brand{font-weight:700;color:#222;text-decoration:none}
.site-header nav a{margin-left:12px;text-decoration:none}
main{padding:20px}
.product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
.card{background:#fff;padding:12px;border-radius:8px}
.form-wrap{max-width:720px;margin:24px auto;background:#fff;padding:16px;border-radius:8px}
.errors{background:#fee;padding:8px;border:1px solid #fbb}
table{width:100%;border-collapse:collapse;background:#fff}
table th, table td{padding:8px;border-bottom:1px solid #eee}
.total{font-weight:700}
.btn{display:inline-block;padding:10px 14px;background:#222;color:#fff;border-radius:6px;text-decoration:none}
console.log('Main JS loaded');

CREATE DATABASE IF NOT EXISTS ecommerce DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE ecommerce;

CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  email VARCHAR(150) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

CREATE TABLE products (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  price DECIMAL(10,2) NOT NULL,
  image VARCHAR(255) DEFAULT 'assets/img-placeholder.png',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

CREATE TABLE carts (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NULL,
  session_id VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
) ENGINE=InnoDB;

CREATE TABLE cart_items (
  id INT AUTO_INCREMENT PRIMARY KEY,
  cart_id INT NOT NULL,
  product_id INT NOT NULL,
  quantity INT NOT NULL DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (cart_id) REFERENCES carts(id) ON DELETE CASCADE,
  FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
) ENGINE=InnoDB;

INSERT INTO products (name, description, price) VALUES
('Blue T‑Shirt','Comfortable cotton t-shirt',299.00),
('Wireless Earbuds','Bluetooth 5.0 earbuds with charging case',1499.00),
('Coffee Mug','Ceramic mug 350ml',199.00);
